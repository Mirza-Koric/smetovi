---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import BaseHead from "../components/BaseHead.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body class="contact-page">
    
    
    <Header />
    <main
      class="flex flex-col md:flex-row justify-center w-[90%] lg:w-[85%] mx-auto mt-24"
    >
      <section class="contact-form-section contact-info w-full md:w-1/2 box-border h-100 m-3">
        <h1
          class="md:px-2 max-md:mx-2 rounded font-exo2 uppercase text-3xl sm:text-4xl md:text-5xl font-bold mb-4"
        >
          Kontaktirajte nas
        </h1>
        <hr class="md:px-2 mx-2 bg-yellow border-0 h-1 w-56" />
        <div class="m-2 flex gap-3">
          <span><i class="fa-solid fa-location-dot"></i></span>
          <span>Smetovi, Zenica, Bosna i Hercegovina</span>
        </div>
        <div class="m-2 flex gap-3">
          <span><i class="fa-solid fa-phone"></i></span>
          <span>032 979 844</span>
        </div>
        <div class="m-2 flex gap-3">
          <span><i class="fa-solid fa-envelope"></i></span>
          <span>info@zeforge.ba</span>
        </div>
        <h1
          class="md:px-2 max-md:mx-2 rounded font-exo2 uppercase text-3xl sm:text-4xl md:text-5xl font-bold mt-8 mb-4"
        >
          Newsletter
        </h1>
        <hr class="md:px-2 mx-2 bg-yellow border-0 h-1 w-56" />
        <p class="m-2 mb-4">
          Pridružite se našoj zajednici ljubitelja prirode i planinarenja!
          Pretplatite se na naš newsletter kako biste prvi saznali o novostima
          sa Smetova, nadolazećim događajima, savjetima za planinarenje i
          aktivnostima na planini. Ostanite povezani s prirodom i uvijek
          informisani!
        </p>
        <form id="newsletterForm" onsubmit="return false;">
          <input
            name="email"
            type="email"
            class="w-[95%] p-2 border border-gray-300 rounded m-2"
            placeholder="Vaša e-mail adresa"
          />
          <button class="m-2">
            <div class="diagonal-border p-[2px] bg-darkBlue">
              <div class="diagonal-square px-4 py-2 w-40">
                Prijavi se
              </div>
            </div>
          </button>
        </form>        
      </section>
      <section class="flex contact-form-section contact-form w-full md:w-1/2 p-1 box-border h-100 m-3">
        <form id="contactForm" class="space-y-4 h-120 flex flex-col flex-1 items-start" onsubmit="return false;">
          <div class="w-full flex flex-col md:flex-row gap-5 justify-between">
            <div class="w-full">
              <label for="name" class="block text-sm font-medium text-gray-700">Ime</label>
            </div>
            <div class="w-full">
              <label for="lastName" class="block text-sm font-medium text-gray-700">Prezime</label>
            </div>
          </div>
          <div class="w-full flex flex-col md:flex-row gap-2">
            <input
              type="text"
              id="name"
              name="name"
              required
              class="w-full p-2 border border-gray-300 rounded"
              placeholder="Vaše ime"
            />
  
            <input
              type="text"
              id="lastName"
              name="lastName"
              required
              class="w-full p-2 border border-gray-300 rounded"
              placeholder="Vaše prezime"
            />
          </div>

          <label for="email" class="block text-sm font-medium text-gray-700"
            >Email:</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            class="w-full p-2 border border-gray-300 rounded"
            placeholder="Vaša e-mail adresa"
          />

          <label for="subject" class="block text-sm font-medium text-gray-700"
            >Predmet:</label>
          <input
            type="text"
            id="subject"
            name="subject"
            required
            class="w-full p-2 border border-gray-300 rounded"
            placeholder="O čemu nas želite kontaktirati"
          />

          <label for="message" class="block text-sm font-medium text-gray-700"
            >Poruka:</label
          >
          <textarea
            id="message"
            name="message"
            rows="5"
            required
            class="w-full h-full p-5 border border-gray-300 rounded"
            placeholder="Vaša poruka"></textarea>

            <button type="submit">
              <div class="diagonal-border px-4 py-3 w-40 bg-darkBlue text-white">
                Pošalji
              </div>
            </button>
        </form>
      </section>
    </main>
    <Footer />

    <script>
      async function sendInquiryEmail(formData: FormData) {
        const values = Object.fromEntries(formData.entries());

        const emailData = {
          subject: values.subject || "No Subject",
          text: `
            Nova poruka od korisnika smetovi.ba:

            Ime: ${values.name}
            Prezime: ${values.lastName}
            Kontakt: ${values.email}
            Detalji: ${values.message}
          `,
          senderName: values.name,
          senderContact: values.email,
        };

        await sendEmail(emailData)
      }

      async function sendNewsletterEmail(formData: FormData) {
        const values = Object.fromEntries(formData.entries());
        values.name = "Newsletter"
        values.lastName = "Newsletter"
        values.subject = "Newsletter"
        values.message = ""

        const emailData = {
          subject: values.subject || "No Subject",
          text: `Korisnik sa e-mail adresom "${values.email}" se želi pretplatiti na sadržaj web stranice smetovi.ba.`,
          senderName: values.name,
          senderContact: values.email,
        };

        await sendEmail(emailData)
      }

      async function sendEmail(formData: Object) {
        try {
          const response = await fetch(
            "https://busezapi.zeforge.ba/sendEmail",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            },
          );

          if (response.ok) {
            alert("Email sent successfully!");
          } else {
            alert("Failed to send email.");
          }
        } catch (error) {
          console.error("Error sending email:", error);
          alert("An error occurred while sending the email.");
        }
      }

      document
        .getElementById("contactForm")
        ?.addEventListener("submit", async function (event) {
          event.preventDefault();
          const formData = new FormData(event.target as HTMLFormElement);
          await sendInquiryEmail(formData);
        });

      document
        .getElementById("newsletterForm")
        ?.addEventListener("submit", async function (event) {
          event.preventDefault();
          const formData = new FormData(event.target as HTMLFormElement);
          await sendNewsletterEmail(formData);
        });
    </script>

    <svg width="0" height="0" class="hidden">
      <defs>
        <mask id="diagonal-mask" maskUnits="objectBoundingBox">
          <polygon fill="white" points="
            0,0         <!-- top-left -->
            0.9,0       <!-- almost top-right -->
            1,0.1       <!-- diagonal top-right -->
            1,1         <!-- bottom-right -->
            0.1,1       <!-- almost bottom-left -->
            0,0.9       <!-- diagonal bottom-left -->
          " />
        </mask>
      </defs>
    </svg>
  </body>
</html>
